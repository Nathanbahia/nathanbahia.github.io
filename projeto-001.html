<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300&display=swap">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css">
    <link rel="stylesheet" href="src/css/prism.css">
    <link rel="stylesheet" href="src/css/estilo.css">
    <title>@NoobPythonBR</title>
  </head>
  <body>
	
	<header class='container-fluid'>
		<img src='src/images/banner.jpg' id='banner'>
		<ul class='navbar nav '>
			<li><a target="blank" href="https://github.com/Nathanbahia"><i class="fab fa-github-square"></i></a></li>
			<li><a target="blank" href="https://linkedin.com/in/nathanbahia"><i class="fab fa-linkedin"></i></a></li>
			<li><a target="blank" href="https://instagram.com/noobpythonbr"><i class="fab fa-instagram"></i></a></li>
		</ul>
		<h1 class="myname">P-001 - Interfaces Gráficas com Tkinter e Banco de Dados SQLite3</h1>
		<a class="btn btn-outline-warning" href="https://github.com/Nathanbahia/noobpythonbr" target="_blank">Acesse o repositório no GitHub</a>
	</header>
	
	<hr>
	    <button class="btn btn-danger"><a href="index.html">Voltar à Página Inicial</a></button>
	<hr>

	<main class='container'>
	    
	    <div class="video">
            <video width="320" controls>
                <source src="src/videos/P-001 - Tela de Login.mp4" type="video/mp4">
            </video>
	    </div>
	    
	    <div class="comment">
	        <p>Este foi um projeto que foi bastante divertido de desenvolver. Usei alguns conhecimentos que já tinha em criação de Interfaces com Tkinter e aprendi algumas coisas novas ao longo do desenvolvimento. A parte do banco de dados também foi legal construir separada da interface, pois assim o código fica mais limpo e mais fácil de se entender.</p>
	        
	        <p>Acesse o repositório no GitHub para ter acesso aos arquivos de imagem que usei no projeto.</p>
	    </div>
	    
    	<div class="codigo">
        	<pre><code class="language-python">
import sqlite3

class Banco:
    def __init__(self):
        """
        Todos os elementos criados dentro deste método são executados assim um objeto da classe
        for instanciado
        
        Inicia conexão com o banco de dados e cria tabela de usuários
        
        Inicialização das propriedades da classe:
            self.conn: Conexão com o banco de dados 'users.bd' dentro da pasta database.
                Caso não exista esse banco de dados, um novo é criado.
            
            self.cursor: Realiza as operações dentro do banco de dados
        """
        
        self.conn = sqlite3.connect("database/users.db")
        self.cursor = self.conn.cursor()
        
        
        """
        Usando a sintaxe SQL cria-se uma tabela dentro do banco de dados
        com as seguintes características:
        
        Nome da tabela: users
        Campos:
            username (texto e não nulo)
            senha (texto e não nulo)
        """
        
        self.cursor.execute("""
            CREATE TABLE IF NOT EXISTS users (
                username TEXT NOT NULL,
                password TEXT NOT NULL
            )
        """)
        
        """
        Sempre que uma alteração for feita dentro do banco deve-se usar
        o método commit()
        """
        
        self.conn.commit()


    def create_user(self, username, password):
        """ Insere no banco de dados um novo usuário com username e password
        
        Recebe dois parâmetros e os usa na sequência abaixo para inserir na
        tabela users, nos campos username e password, os dois valores recebidos
        e em seguida o self.conn.commit() é executado para salvar as alterações
        feitas no banco. Por fim, retorna True se todo o processo for concluído
        com exito.
        """
        
        self.cursor.execute(f"INSERT INTO users (username, password) VALUES ('{username}', '{password}')")
        self.conn.commit()
        return True

    def check_user(self, username, password):
        """
        Realizando uma busca por todos os usuários no banco de dados,
        é atribuído à variável users o retorno da pesquisa. Através do loop
        'for' cada 'u' assume a forma de uma tupla do seguinte modelo:
        
        ('noobpythonbr', 'minhasenha')
        
        Sendo o primeiro elemento o usuário e o segundo a senha. Com uma comparação
        simples e usando o operador 'and' podemos verificar se existe
        algum usuário com exatamente as mesmas credencias passadas como parâmetro
        para o método.
        
        Caso encontre, o método retorna True, caso contrário retorna False.
        """
        
        users = self.cursor.execute("SELECT * FROM users")
        for u in users.fetchall():
            if u[0] == username and u[1] == password:
                return True
        return False
        
        
""" Por fim, criamos nosso objeto banco a partir da classe Banco """
    
banco = Banco()




""" Importação dos módulos necessários para criar a interface """
from tkinter import *
from tkinter import font


""" Criação de algunas contantes como fontes e cores """
FONT_MD = "Courier 12 bold"
FONT_SM = "Courier 10"
BG = "#58D3F7"
FG = "#121212"


"""
Criação da interface gráfica

O método contrutor __init__ recebe como parâmetro um objeto Tk no momento
de sua criação (veja no final do código), que neste caso estou usando um alias
chamado master. Este é a 'janela' raiz onde serão colocados os demais elementos.
"""
        

class App:
    def __init__(self, master):
        """ Inicia a inteface gráfica do sistema
        
        Todos os elementos criados dentro deste método são executados assim um objeto da classe
        for instanciado
        """
        
        self.master = master
        
        """ Configuração da cor do background """
        self.master.configure(background=BG)
        
         
        """ Carregamento da imagem principal de tela de login """
        self.img_login = PhotoImage(file="images/login.png")
        
        """ Criação e posicionamento de uma label que conterá a imagem """
        self.lbl_img_login = Label(self.master, image=self.img_login, bg=BG)
        self.lbl_img_login.image = self.img_login
        self.lbl_img_login.place(x=0, y=20, w=270)
        
        """ Criação das Labels Username e Password """
        self.lbl_user = Label(self.master, text="Username", bg=BG, fg=FG, font=FONT_SM)
        self.lbl_user.place(x = 10, y = 100)

        self.lbl_pass = Label(self.master, text="Password", bg=BG, fg=FG, font=FONT_SM)
        self.lbl_pass.place(x = 10, y = 150)
        
        """ Criação das caixas de texto para entrada de usuário e senha """
        self.ent_user = Entry(self.master, font=FONT_MD)
        self.ent_user.focus()
        self.ent_user.place(x = 10, y = 125, w=250)

        self.ent_pass = Entry(self.master, show="*", font=FONT_MD)
        self.ent_pass.place(x = 10, y = 175, w=220)
        
        """ Propriedade que controla a exibição das senhas """
        self.ent_pass_is_showing = False

        """ Carregamento da imagem do olho """
        self.img_eye = PhotoImage(file="images/exibir.png")
        
        """ Criação da label que conterá a imagem do olho """
        self.btn_eye = Label(self.master, image=self.img_eye, bg=BG)
        self.btn_eye.image=self.img_eye
        
        """ Atribuição de um evento à label, de que quando houver um clique do mouse
        o método self.show_password_login será executado
        """
        self.btn_eye.bind("<Button-1>", self.show_password_login)
        self.btn_eye.place(x=240, y=175)

        """ Criação do botão de login """
        self.btn_login = Button(self.master, text="Login", font=FONT_MD)
        
        """ Assim como na label do olho, este botão tem dois eventos, sendo o pressionamento
        da tecla ENTER quando o botão estir com foco, ou o clique do mouse. Ambos eventos
        chamam o método self.login """
        self.btn_login.bind("<Return>", self.login)
        self.btn_login.bind("<Button-1>", self.login)
        self.btn_login.place(x = 10, y = 210, w=250)

        """ Criação de uma label vazia que conterá uma mensagem de erro caso o login falhe """
        self.lbl_fail_login = Label(self.master, text="", fg="#ff0000", bg=BG, font="Courier 10 bold")
        self.lbl_fail_login.place(x = 10, y = 250, w=250)
        
        """ Criação da label para criação de conta """
        self.lbl_signin = Label(self.master, text="Create an account", cursor="hand2", fg="#2E64FE", bg=BG, font=FONT_SM)
        
        """ Evento de clique """
        self.lbl_signin.bind("<Button-1>", self.create_user)
        self.lbl_signin.place(x=0, y=270, w=270)
        
        """ Criação de um objeto Font para que o texto possa ser formatado como sublinhado """
        f = font.Font(self.lbl_signin, self.lbl_signin.cget("font"))
        f.configure(underline=True)
        
        """ Atribuição do estilo criado em f à label de criação de conta """
        self.lbl_signin.configure(font=f)

        """ Essas propriedades são iniciadas vazias aqui porque precisam ser acessadas
        e configuradasdentro dos métodos abaixo """
        self.frame = Frame()
        self.ent_new_user = Entry()
        self.ent_new_pass = Entry()
        

    def show_password_login(self, event):
        """ A partir do clique na label do olho, exibe ou oculta a senha na tela de login e
        troca a imagem do olho
        """
        
        if self.ent_pass_is_showing == False:
            self.img_eye = PhotoImage(file="images/ocultar.png")
            self.btn_eye["image"] = self.img_eye
            self.ent_pass["show"] = ""
            self.ent_pass_is_showing = True

        else:
            self.img_eye = PhotoImage(file="images/exibir.png")
            self.btn_eye["image"] = self.img_eye
            self.ent_pass["show"] = "*"
            self.ent_pass_is_showing = False

                         
    def create_user(self, event):
        """ A parir do clique na label de criação de usuários um novo frame é criado
        sobreposto ao frame master. Dentro deste novo frame (self.frame), alguns elementos são
        criados e posicionados.
        """
         
        """ Apaga o texto da label de erro de login caso tenha algum """
        self.lbl_fail_login["text"] = ""
        
        """ Criação de um frame sobreposto ao self.master """
        self.frame = Frame(self.master)
        self.frame.configure(background=BG)
        self.frame.place(x=0, y=0, w=270, h=300)
        
        """ Criação do título da tela """
        lbl_img_create = Label(self.frame, text="Create User", font=FONT_MD, bg=BG)
        lbl_img_create.place(x=0, y=20, w=270)

        """ Criação das labels de username e password """
        lbl_user = Label(self.frame, text="Username", bg=BG, fg=FG, font=FONT_SM)
        lbl_user.place(x = 10, y = 100)

        lbl_pass = Label(self.frame, text="Password", bg=BG, fg=FG, font=FONT_SM)
        lbl_pass.place(x = 10, y = 150)

        """ Criação das caixas de texto de entrada de usuario e senha
        Estas duas caixas são os mesmos elementos que criamos dentro do método __init__,
        cujos textos inseridos serão usados em outro método (self.db_create_user).
        Caso não tivéssemos definidos eles anteriormente, não seria possível acessá-los
        em outro método, pois seriam variáveis locais, e não globais.
        
        """
        self.ent_new_user = Entry(self.frame, font=FONT_MD)
        self.ent_new_user.focus()
        self.ent_new_user.place(x = 10, y = 125, w=250)

        self.ent_new_pass = Entry(self.frame, show="*", font=FONT_MD)
        self.ent_new_pass.place(x = 10, y = 175, w=220)

        """ Da mesma forma que ocorre na tela inicial, aqui também é criado uma label com imagem
        de olho, porém, que chama outro método, o self.show_password_create """
        self.img_eye_create = PhotoImage(file="images/exibir.png")
        self.btn_eye_create = Label(self.frame, image=self.img_eye_create, bg=BG)
        self.btn_eye_create.image=self.img_eye
        self.btn_eye_create.bind("<Button-1>", self.show_password_create)
        self.btn_eye_create.place(x=240, y=175)

        """ Botão de cancelar criação de usuário em que é atribuído somente o evento de clique
        do mouse e que destrói a tela de criação """
        btn_cancel = Button(self.frame, text="Cancel", font=FONT_MD)
        btn_cancel["command"] = self.frame.destroy
        btn_cancel.place(x = 10, y = 225, w=120)

        """ Botão de confirmação da criação usuário, em que são atribuídos dois eventos: tecla enter e clique,
        chama o método self.db.create_user """
        btn_create = Button(self.frame, text="Create User", font=FONT_MD)
        btn_create.bind("<Return>", self.db_create_user)
        btn_create.bind("<Button-1>", self.db_create_user)
        btn_create.place(x = 140, y = 225, w=120)


    def db_create_user(self, event):
        """ Captura os valores inseridos lançados nas caixas de texto, verifica se contém algum conteúdo
            e os usa como parâmetros para o método create_user do banco de dados. Limpa as caixas de texto.
        """
        
        username = self.ent_new_user.get()
        password = self.ent_new_pass.get()

        if username != "" and password != "":
            success = banco.create_user(username, password)
            self.ent_new_user.delete(0, "end")
            self.ent_new_pass.delete(0, "end")
            self.ent_user.delete(0, "end")
            self.ent_pass.delete(0, "end")
            
            if success:
                self.frame.destroy()


    def show_password_create(self, event):
        """ Exibe ou oculta a senha na tela de criação de usuários """
        
        if self.ent_pass_is_showing == False:
            self.img_eye_create = PhotoImage(file="images/ocultar.png")
            self.btn_eye_create["image"] = self.img_eye_create
            self.ent_new_pass["show"] = ""
            self.ent_pass_is_showing = True

        else:
            self.img_eye_create = PhotoImage(file="images/exibir.png")
            self.btn_eye_create["image"] = self.img_eye_create
            self.ent_new_pass["show"] = "*"
            self.ent_pass_is_showing = False
            

    def login(self, event):
        """ Captura os valores inseridos nas caixas de texto e os usa como parâmetros
            para o método check_user do banco de dados. Limpa as caixas de texto.
        """
        
        username = self.ent_user.get()
        password = self.ent_pass.get()
        user = banco.check_user(username, password)

        if user:
            self.create_main_content()
            self.ent_user.delete(0, "end")
            self.ent_pass.delete(0, "end")
            self.lbl_fail_login["text"] = ""
            
        else:
            self.lbl_fail_login["text"] = "Usuário e/ou senha inválidos"
            

    def create_main_content(self):
        """ Exibe o conteúdo da aplicação após o usuário realizar o login """
        
        
        """ Criação de um novo frame sobreposto ao self.master """
        content = Frame(self.master, bg="#ffff00")
        content.place(x=0, y=0, w=270, h=300)

        """ Carregamento da imagem e criação de label que conterá a logo do Python """
        img_python = PhotoImage(file="images/python-img.png")
        lbl_python = Label(content, image=img_python, bg="#ffff00")
        lbl_python.image = img_python
        lbl_python.place(x=0, y=30, w=270)

        """ Simples label com meu arroba """
        lbl_instagram = Label(content, text = "@NoobPythonBR", font=FONT_MD, bg="#ffff00")
        lbl_instagram.place(x=0, y=200, w=270)
                
        """ Botão de logout que tem apenas o event de clique e que destrói o frame 'content' """
        btn_logout = Button(content, text="Logout", font=FONT_SM, bg="#ffff00", fg="#ff0000", cursor="hand2")
        btn_logout["command"] = content.destroy
        btn_logout.place(x=0, y=270, w=270)


""" Criação do objeto Tk """
root = Tk()

""" Nossa classe recebe o objeto Tk como parâmetro (master) """
App(root)

"""
Caso esteja usando Windows, esta é uma maneira de definir o ícone da sua janela.
Tive problemas com isso no Linux.

root.iconbitmap("images/python-icon.ico")
"""

""" Definição do título da janela e as dimensões (largura, altura, posição x, y na tela) """
root.title("Login | @NoobPythonBR")
root.geometry("270x300+200+200")

""" Definição de que a janela não será redimensionada nem na largura, nem na altura """
root.resizable(False, False)

""" Execução do programa """
root.mainloop()
            </code></pre>
    
    
	</main>
	
	<footer class="footer">
	    <div class="container">
	        <div>
				<p id="assinatura">Nathan Bahia</p>
				<p id="apresentacao">Administrador de Empresas, graduando em Análise e Desenvolvimento de Sistemas e terminando um MBA em Gestão Financeira. Sou apaixonado por tecnologia, podcasts, aprender coisas novas e desafios.</p>
			</div>
	        <ul class='navbar nav '>
				<li><a target="blank" href="https://github.com/Nathanbahia"><i class="fab fa-github-square"></i></a></li>
				<li><a target="blank" href="https://linkedin.com/in/nathanbahia"><i class="fab fa-linkedin"></i></a></li>
				<li><a target="blank" href="https://instagram.com/noobpythonbr"><i class="fab fa-instagram"></i></a></li>
			</ul>
	    </div>
	</footer>
	
    

    <script src="src/js/prism.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
  </body>
</html>
